Данная лабораторная работа продолжает повествование главы о [локализации проектов](https://github.com/UsamG1t/Methodics_of_LinuxAppDev/blob/master/Methodical_manual/08_I18n/8.%20%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F%20%D0%B8%20%D0%BB%D0%BE%D0%BA%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F.md).

---

При разработке для определённой аудитории необходимо проводить интернационализацию и локализацию продукта. Подробнее о них описано в [главе](https://github.com/UsamG1t/Methodics_of_LinuxAppDev/blob/master/Methodical_manual/08_I18n/8.%20%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F%20%D0%B8%20%D0%BB%D0%BE%D0%BA%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F.md#%D0%BE%D0%B1%D0%BB%D0%B0%D1%81%D1%82%D1%8C-%D0%B2%D0%BB%D0%B8%D1%8F%D0%BD%D0%B8%D1%8F). Одной из основных задач локализации является перевод текстов с поддержкой множественных форм. Для этого в дистрибутивах семейства Альт используется пакет `glibs-locales`, хранящий основные библиотеки для работы с переводами и их поддержки.

---

## Работа с `Gettext`

Рассмотрим программу, последовательно считающую овец:

`@user`: `in-place/src/sheepcounter.c`

```c
#include <stdio.h>
#include <stdlib.h>
#include <libgen.h>
#include <libintl.h>
#include <locale.h>

#define _(STRING) gettext(STRING)
#define LOCALE_PATH "."

int main(int argc, char *argv[])
{
       int count;

       setlocale (LC_ALL, "");
       bindtextdomain ("sheepcounter", LOCALE_PATH);
       textdomain ("sheepcounter");

       /* Simple text */
       puts(_("Let\'s count sheeps together!\n"));
       puts(_("How many sheeps do you want to count? "));

       scanf("%d", &count);

#ifndef NUMBERS
       while (count >= 10) {
               puts(_("Oh, I know only digits, not numbers, try again: "));
               scanf("%d", &count);
       }
#endif

       for(int i = 1; i <= count; i++)
               /* Plural example */
               printf(ngettext("We counted %d sheep\n", "We counted %d sheeps\n", i), i);

       return 0;
}
```

Для работы с переводами используется специальный набор инструментов [GNU gettext](https://www.gnu.org/software/gettext/). С помощью специальных функций-обёрток `gettext` и `ngettext` из библиотеки `locale.h` обозначаются элементы, которые необходимо будет локализовать. Для элементов, в которых возможна множественная форма, указывается также параметр, от которой она будет зависеть.

Для работы с переводами также необходимо завести _домен_ — отдельное множество переведённых строк, изолированное от других переводов _в ту же локаль_. Путь к домену указывается с помощью специальной функции.

Путь в `bindtextdomain` описывает место в файловой системе, где `gettext` будет при исполнении программы искать файлы с переводом (при этом файлы лежат в поддиректориях формата «<Язык перевода>/<Параметр локали>/<Файл перевода>»).

Для генерации шаблона перевода (`pot` — `po template`) используется утилита `xgettext`, которой указывается название функции-обёртки, входной и выходной файлы: `xgettext -k_ -c src/sheepcounter.c -o po/sheepcounter.pot`.

`@user`: `sheepcounter-pkg/po/sheepcounter.pot`

```sh
# SOME DESCRIPTIVE TITLE.
# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2025-07-24 17:22+0300\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=CHARSET\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=INTEGER; plural=EXPRESSION;\n"

#. Simple text
#: src/sheepcounter.c:19
msgid "Let's count sheeps together!\n"
msgstr ""

#: src/sheepcounter.c:20
msgid "How many sheeps do you want to count? "
msgstr ""

#: src/sheepcounter.c:26
msgid "Oh, I know only digits, not numbers, try again: "
msgstr ""

#. Plural example
#: src/sheepcounter.c:33
#, c-format
msgid "We counted %d sheep\n"
msgid_plural "We counted %d sheeps\n"
msgstr[0] ""
msgstr[1] ""
```

Шаблон содержит все элементы, требующие локализации. Для создания генератора перевода используется функция `msginit` с указанием локали: `msginit -i po/sheepcounter.pot -o po/sheepcounter.po -l ru_RU.UTF-8`. При наличии уже написанного генератора (например, при внесении каких-то изменений в исходный код программы, требующих дополнительной локализации) новый шаблон объединяется со старым генератором с помощью `msgmerge`: `msgmerge -U po/sheepcounter.po po/sheepcounter.pot`.

Генератор перевода содержит мета-данные о конкретном переводе в описанном домене на описанном языке (например, указывается тернарный оператор для выбора множественной словоформы, поскольку в русском их не две, как в английском, а три). Затем он вручную заполняется разработчиком:

`@user`: `sheepcounter-pkg/po/sheepcounter.po`

```sh
# Russian translations for PACKAGE package
# Английские переводы для пакета PACKAGE.
# Copyright (C) 2025 THE PACKAGE'S COPYRIGHT HOLDER
# This file is distributed under the same license as the PACKAGE package.
#  <user@usamg1tvm>, 2025.
#
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2025-07-24 17:22+0300\n"
"PO-Revision-Date: 2025-07-24 17:34+0300\n"
"Last-Translator:  <user@usamg1tvm>\n"
"Language-Team: Russian <gnu@d07.ru>\n"
"Language: ru\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=3; plural=(n%10==1 && n%100!=11 ? 0 : n%10>=2 && n"
"%10<=4 && (n%100<10 || n%100>=20) ? 1 : 2);\n"

#. Simple text
#: src/sheepcounter.c:19
msgid "Let's count sheeps together!\n"
msgstr "Давай считать овец вместе!\n"

#: src/sheepcounter.c:20
msgid "How many sheeps do you want to count? "
msgstr "Сколько овец ты хочешь посчитать? "

#: src/sheepcounter.c:26
msgid "Oh, I know only digits, not numbers, try again: "
msgstr "Оу, я знаю только цифры, не числа, напиши что-то другое: "

#. Plural example
#: src/sheepcounter.c:33
#, c-format
msgid "We counted %d sheep\n"
msgid_plural "We counted %d sheeps\n"
msgstr[0] "Мы посчитали %d овцу\n"
msgstr[1] "Мы посчитали %d овцы\n"
msgstr[2] "Мы посчитали %d овец\n"
~
```

Для генерации файла перевода используется функция `msgfmt`. Предварительно необходимо создать и указать поддиректории для расположения файла перевода.

```sh
mkdir -p ru/LC_MESSAGES/
msgfmt po/sheepcounter.po -o ru/LC_MESSAGES/sheepcounter.mo
```

Итоговый набор необходимых для работы файлов выглядит так:
```console
in-place/
├── po
│   └── sheepcounter.po
├── ru
│   └── LC_MESSAGES
│       └── sheepcounter.mo
└── src
   └── sheepcounter.c
```

Скомпилируем программу и проверим её работу:

`@user`
```console
[user@VM in-place]$ cc src/sheepcounter.c -o sheepcounter
[user@VM in-place]$ ./sheepcounter
Давай считать овец вместе!

Сколько овец ты хочешь посчитать?
10
Оу, я знаю только цифры, не числа, напиши что-то другое:
5
Мы посчитали 1 овцу
Мы посчитали 2 овцы
Мы посчитали 3 овцы
Мы посчитали 4 овцы
Мы посчитали 5 овец
[user@VM in-place]$ LC_MESSAGES=en_US.UTF-8 ./sheepcounter
Let's count sheeps together!

How many sheeps do you want to count?
4
We counted 1 sheep
We counted 2 sheeps
We counted 3 sheeps
We counted 4 sheeps
[user@VM in-place]$
```

## Сборка пакета с поддержкой переводов

Соберём пакет, в котором будут поддерживаться переводы. При этом возникают некоторые особенности установки.

При установке пакета в систему файлы переводов должны быть установлены в специальную директорию хранения всех переводов приложений системы — `/usr/share/local`. Внутри этой директории также производится разделение на язык перевода и параметр локали.

Для сборки напишем небольшой `Makefile`

`@user`: `sheepcounter-pkg/Makefile`

```make
RU = ru/LC_MESSAGES
PACKAGE = sheepcounter
CFLAGS = -Wall -O0 -g
CC = cc

GENS = */*.mo $(PACKAGE) */*.pot
TRASH = *.o *~ o.*

all: $(RU)/$(PACKAGE).mo $(PACKAGE)

$(PACKAGE): src/$(PACKAGE).c
       $(CC) $(CFLAGS) $< -o $@

$(RU)/$(PACKAGE).mo: po/$(PACKAGE).po
       mkdir -p `dirname $@`
       msgfmt $< -o $@

po/$(PACKAGE).pot: src/$(PACKAGE).c
       xgettext -k_ -c $< -o $@

po/$(PACKAGE).po:  po/$(PACKAGE).pot
       msgmerge -U $@ $<

clean:
	rm -f $(TRASH)

distclean:	clean
	rm -f $(GENS)
```

В самой программе переопределим новый путь к расположению переводов, а также добавим макрос для названия домена по имени пакета:

`@user`: `sheepcounter-pkg/src/sheepcounter.c`

```c
#include <stdio.h>
#include <stdlib.h>
#include <libgen.h>
#include <libintl.h>
#include <locale.h>


#define _(STRING) gettext(STRING)
#define PACKAGE "sheepcounter"
#define LOCALE_PATH "/usr/share/localе"

int main(int argc, char *argv[])
{
       int count;

       setlocale (LC_ALL, "");
       bindtextdomain (PACKAGE, LOCALE_PATH);
       textdomain (PACKAGE);

       /* Simple text */
       puts(_("Let\'s count sheeps together!\n"));
       puts(_("How many sheeps do you want to count? "));

       scanf("%d", &count);

#ifndef NUMBERS
       while (count >= 10) {
               puts(_("Oh, I know only digits, not numbers, try again: "));
               scanf("%d", &count);
       }
#endif

       for(int i = 1; i <= count; i++)
               /* Plural example */
               printf(ngettext("We counted %d sheep\n", "We counted %d sheeps\n", i), i);

       return 0;
}
```

Добавим `.gear/rules` и `spec`-файл:

`@user`: `sheepcounter-pkg/.gear/rules`

```
spec:   .gear/sheepcounter.spec
tar.gz: . name=@name@-@version@
```

`@user`: `sheepcounter-pkg/.gear/sheepcounter.spec`

```spec
Name: sheepcounter
Version: 0.0
Release: alt1

Summary: Test pkg with i18n

License: GPLv3+
Group: Development/Other

Source0: %name-%version.tar.gz

%description
This is a small testing package, builded with i18n

%prep
%setup

%build
%make_build

%install
install -D %name %buildroot%_bindir/%name-so
install -D -m644 ru/LC_MESSAGES/%name.mo %buildroot%_datadir/locale/ru/LC_MESSAGES/%name.mo


%files
%_bindir/%name
%_datadir/locale/*/*/*.mo

%changelog
* Wed Jul 30 2025 UsamG1t <usamg1t@altlinux.org> 0.0-alt1
- Initial build
```

В `spec`-файле производится ручная установка исполняемого файла и файла переводов, в директиве `%files` явно описаны итоговые файлы пакета.

Соберём пакет и попробуем запустить его:

`@user`
```console
[user@VM sheepcounter-pkg]$ gear-hsh --lazy
<...>
[user@VM sheepcounter-pkg]$ cd
[user@VM ~]$ cp hasher/repo/x86_64/RPMS.hasher/sheepcounter-0.0-alt1.x86_64.rpm hasher/chroot/.in
[user@VM ~]$ hypersh --rooter
```

`@rooter`
```console
[root@localhost .in]# rpm -i sheepcounter-0.0-alt1.x86_64.rpm
<13>Jul 30 05:59:13 rpm: sheepcounter-0.0-alt1 1753854986 installed
                                                                  [root@localhost .in]#
[root@localhost .in]# which sheepcounter
/usr/bin/sheepcounter

[root@localhost .in]# locale
LANG=C.UTF-8
LC_CTYPE="C.UTF-8"
LC_NUMERIC="C.UTF-8"
LC_TIME="C.UTF-8"
LC_COLLATE="C.UTF-8"
LC_MONETARY="C.UTF-8"
LC_MESSAGES="C.UTF-8"
LC_PAPER="C.UTF-8"
LC_NAME="C.UTF-8"
LC_ADDRESS="C.UTF-8"
LC_TELEPHONE="C.UTF-8"
LC_MEASUREMENT="C.UTF-8"
LC_IDENTIFICATION="C.UTF-8"
LC_ALL=

[root@localhost .in]# sheepcounter
Let's count sheeps together!

How many sheeps do you want to count?
10
Oh, I know only digits, not numbers, try again:
6
We counted 1 sheep
We counted 2 sheeps
We counted 3 sheeps
We counted 4 sheeps
We counted 5 sheeps
We counted 6 sheeps

[root@localhost .in]# LC_MESSAGES=ru_RU.UTF-8 sheepcounter
Давай считать овец вместе!

Сколько овец ты хочешь посчитать?
8
Мы посчитали 1 овцу
Мы посчитали 2 овцы
Мы посчитали 3 овцы
Мы посчитали 4 овцы
Мы посчитали 5 овец
Мы посчитали 6 овец
Мы посчитали 7 овец
Мы посчитали 8 овец
[root@localhost .in]#
```

## Переводы с помощью `autotools`

Добавим `autotools`-поддержку переводов. Описание генерации переводов здесь делается не вручную в `Makefile.am`, а описывается в специальных шаблонных файлах `Makevars` и `POTFILES.in`, чтобы из них сгенерировать `Makefile.am`, который в свою очередь сгенерирует `Makefile` для сборки проекта. Также для автоматической сборки перевода файл перевода должен называться названием языка перевода, в нашем случае `ru.po`.

`@user` `sheepcounter-pkg/po/Makevars`

```make
# Makefile variables for PO directory in any package using GNU gettext.
#
# Copyright (C) 2003-2019 Free Software Foundation, Inc.
# This file is free software; the Free Software Foundation gives
# unlimited permission to use, copy, distribute, and modify it.

# Usually the message domain is the same as the package name.
DOMAIN = $(PACKAGE)

# These two variables depend on the location of this directory.
subdir = po
top_builddir = ..

# These options get passed to xgettext.
XGETTEXT_OPTIONS = --keyword=_ --keyword=N_

# This is the copyright holder that gets inserted into the header of the
# $(DOMAIN).pot file.  Set this to the copyright holder of the surrounding
# package.  (Note that the msgstr strings, extracted from the package's
# sources, belong to the copyright holder of the package.)  Translators are
# expected to transfer the copyright for their translations to this person
# or entity, or to disclaim their copyright.  The empty string stands for
# the public domain; in this case the translators are expected to disclaim
# their copyright.
COPYRIGHT_HOLDER = Free Software Foundation, Inc.

# This tells whether or not to prepend "GNU " prefix to the package
# name that gets inserted into the header of the $(DOMAIN).pot file.
# Possible values are "yes", "no", or empty.  If it is empty, try to
# detect it automatically by scanning the files in $(top_srcdir) for
# "GNU packagename" string.
PACKAGE_GNU =

# This is the email address or URL to which the translators shall report
# bugs in the untranslated strings:
# - Strings which are not entire sentences, see the maintainer guidelines
#   in the GNU gettext documentation, section 'Preparing Strings'.
# - Strings which use unclear terms or require additional context to be
#   understood.
# - Strings which make invalid assumptions about notation of date, time or
#   money.
# - Pluralisation problems.
# - Incorrect English spelling.
# - Incorrect formatting.
# It can be your email address, or a mailing list address where translators
# can write to without being subscribed, or the URL of a web page through
# which the translators can contact you.
MSGID_BUGS_ADDRESS =

# This is the list of locale categories, beyond LC_MESSAGES, for which the
# message catalogs shall be used.  It is usually empty.
EXTRA_LOCALE_CATEGORIES =

# This tells whether the $(DOMAIN).pot file contains messages with an 'msgctxt'
# context.  Possible values are "yes" and "no".  Set this to yes if the
# package uses functions taking also a message context, like pgettext(), or
# if in $(XGETTEXT_OPTIONS) you define keywords with a context argument.
USE_MSGCTXT = no

# These options get passed to msgmerge.
# Useful options are in particular:
#   --previous            to keep previous msgids of translated messages,
#   --quiet               to reduce the verbosity.
MSGMERGE_OPTIONS =

# These options get passed to msginit.
# If you want to disable line wrapping when writing PO files, add
# --no-wrap to MSGMERGE_OPTIONS, XGETTEXT_OPTIONS, and
# MSGINIT_OPTIONS.
MSGINIT_OPTIONS =

# This tells whether or not to regenerate a PO file when $(DOMAIN).pot
# has changed.  Possible values are "yes" and "no".  Set this to no if
# the POT file is checked in the repository and the version control
# program ignores timestamps.
PO_DEPENDS_ON_POT = yes

# This tells whether or not to forcibly update $(DOMAIN).pot and
# regenerate PO files on "make dist".  Possible values are "yes" and
# "no".  Set this to no if the POT file and PO files are maintained
# externally.
DIST_DEPENDS_ON_UPDATE_PO = yes
```

`@user`: `sheepcounter-pkg/po/POTFILES.in`
```
src/sheepcounter.c
```

Также необходимо явно указать директорию сохранения переводов через макросы `autotools` с помощью `AM_FLAGS`. Также, поскольку `Makefile.am` разбиты по директориям, необходим объединяющий их заглавный `Makefile.am`

`@user`: `sheepcounter-pkg/Makefile.am`

```make
SUBDIRS = src po
```

`@user`: `sheepcounter-pkg/src/Makefile.am`

```make
CFLAGS = -Wall -O0 -g
AM_CFLAGS=-D'LOCALE_PATH="$(localedir)"'

bin_PROGRAMS=sheepcounter
```

Поскольку имя пакета придёт в макрос `PACKAGE` из `configure.ac`, а `LOCALE_PATH` определяется при сборке, из `C`-файла их необходимо убрать, а заодно добавить `config.h` в заголовках:

`@user`: `sheepcounter-pkg/src/sheepcounter.c`

```c
#include <stdio.h>
#include <stdlib.h>
#include <libgen.h>
#include <libintl.h>
#include <locale.h>
#include "config.h"

#define _(STRING) gettext(STRING)

int main(int argc, char *argv[])
{
       int count;

       setlocale (LC_ALL, "");
       bindtextdomain (PACKAGE, LOCALE_PATH);
       textdomain (PACKAGE);

       /* Simple text */
       puts(_("Let\'s count sheeps together!\n"));
       puts(_("How many sheeps do you want to count? "));

       scanf("%d", &count);

#ifndef NUMBERS
       while (count >= 10) {
               puts(_("Oh, I know only digits, not numbers, try again: "));
               scanf("%d", &count);
       }
#endif

       for(int i = 1; i <= count; i++)
               /* Plural example */
               printf(ngettext("We counted %d sheep\n", "We counted %d sheeps\n", i), i);

       return 0;
}
```

Добавим сам `configure.ac`:

`@user`: `sheepcounter-pkg/configure.ac`

```sh
#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.


AC_INIT([sheepcounter], [1.0], [UsamG1t])
AM_INIT_AUTOMAKE([foreign])
AM_GNU_GETTEXT(external)
AM_GNU_GETTEXT_VERSION(0.21)
AC_CONFIG_SRCDIR([src/sheepcounter.c])
AC_CONFIG_HEADERS([config.h])
AC_SUBST(GETTEXT_PACKAGE, "$PACKAGE")
ALL_LINGUAS="ru"

# Checks for programs.
AC_PROG_CC
IT_PROG_INTLTOOL

# Checks for libraries.

# Checks for header files.
AC_CHECK_HEADERS([libintl.h])

# Optional clues
AC_ARG_ENABLE([numbers],
       AS_HELP_STRING([--enable-numbers],[Enable not only digits counting]),
       AS_IF([test "$enable_numbers" = "yes"],
               AC_DEFINE(NUMBERS, [], [Numbers counting acception]))
)

# Checks for typedefs, structures, and compiler characteristics.

# Checks for library functions.
AC_CHECK_FUNCS([realpath setlocale])
AC_FUNC_ERROR_AT_LINE

AC_CONFIG_FILES([Makefile po/Makefile.in src/Makefile])
AC_OUTPUT
```

 + В настройки программы также добавлен параметр для работы с числами, а не только с цифрами. Отслеживается он с помощью ключей `--{enable/disable}-numbers`. Ключи присваивают значения `yes` или `no` макросу соответственно, в зависимости от значения производится его определение.

```
.
├── configure.ac
├── Makefile.am
├── po
│   ├── Makevars
│   ├── POTFILES.in
│   └── ru.po
└── src
   ├── Makefile.am
   └── sheepcounter.c
```

Отредактируем `spec`-файл и соберём пакет:

`@user`: `sheepcounter-pkg/.gear/sheepcounter.spec`

```spec
%def_disable numbers

Name: sheepcounter
Version: 1.0
Release: alt1

Summary: Test pkg with i18n

License: GPLv3+
Group: Development/Other

Source0: %name-%version.tar.gz

%description
This is a small testing package, builded with i18n

%prep
%setup

%build
%autoreconf
%configure %{subst_enable numbers}
%make_build

%install
%makeinstall_std

%files
%_bindir/%name
%_datadir/locale/*/*/*.mo

%changelog
* Wed Jul 30 2025 UsamG1t <usamg1t@altlinux.org> 1.0-alt1
- Autotools upgrade

* Wed Jul 30 2025 UsamG1t <usamg1t@altlinux.org> 0.0-alt1
- Initial build
```

Соберём пакет:

`@user`
```console
[user@VM sheepcounter-pkg]$ gear-hsh
<...>
+ ./configure --build=x86_64-alt-linux --host=x86_64-alt-linux --prefix=/usr --exec-prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --datadir=/usr/share --includedir=/usr/include --libdir=/usr/lib64 --libexecdir=/usr/lib --localstatedir=/var/lib --sharedstatedir=/var/lib --mandir=/usr/share/man --infodir=/usr/share/info --disable-dependency-tracking --disable-silent-rules --runstatedir=/var/run --without-included-gettext --disable-numbers
<...>
```

Отдельно заметим в выводе секцию по обработке переводов: производится автоматическая сборка `.mo`-файла с его последующей установкой в правильную директорию.

```
Making all in po
<...>
rm -f ru.gmo && /usr/bin/msgmerge --for-msgfmt -o ru.1po ru.po sheepcounter.pot && /usr/bin/msgfmt -c --statistics --verbose -o ru.gmo ru.1po && rm -f ru.1po
<...>
Making install in po
make[1]: Entering directory '/usr/src/RPM/BUILD/sheepcounter-1.0/po'
installing ru.gmo as /usr/src/tmp/sheepcounter-buildroot/usr/share/locale/ru/LC_MESSAGES/sheepcounter.mo
<...>
Wrote: /usr/src/RPM/SRPMS/sheepcounter-1.0-alt1.src.rpm (w2.lzdio)
Wrote: /usr/src/RPM/RPMS/x86_64/sheepcounter-1.0-alt1.x86_64.rpm (w2.lzdio)
Wrote: /usr/src/RPM/RPMS/x86_64/sheepcounter-debuginfo-1.0-alt1.x86_64.rpm (w2.lzdio)
5.85user 4.55system 0:14.41elapsed 72%CPU (0avgtext+0avgdata 22040maxresident)k
128inputs+11632outputs (0major+541655minor)pagefaults 0swaps
[user@VM sheepcounter-pkg]$
```

Проверим работу пакета, после пересоберём его с указанием параметра и вновь проверим работу (Язык в `hasher` из примера установлен английский по умолчанию):

`@user`
```console
[user@VM ~]$ hypersh hasher/repo/SRPMS.hasher/sheepcounter-1.0-alt1.src.rpm
<...>
[user@VM ~]$ cp hasher/repo/x86_64/RPMS.hasher/sheepcounter-1.0-alt1.x86_64.rpm hasher/chroot/.in/
[user@VM ~]$ hypersh --rooter
```

`@rooter`
```
[root@localhost .in]# rpm -i sheepcounter-1.0-alt1.x86_64.rpm
<13>Jul 30 10:03:41 rpm: sheepcounter-1.0-alt1 1753869570 installed
                                                                  [root@localhost .in]#
[root@localhost .in]# ls /usr/share/locale/ru/LC_MESSAGES/sheepcounter.mo
/usr/share/locale/ru/LC_MESSAGES/sheepcounter.mo
[root@localhost .in]# sheepcounter
Let's count sheeps together!

How many sheeps do you want to count?
30
Oh, I know only digits, not numbers, try again:
3
We counted 1 sheep
We counted 2 sheeps
We counted 3 sheeps

[root@localhost .in]# LC_MESSAGES=ru_RU.UTF-8 sheepcounter
Давай считать овец вместе!

Сколько овец ты хочешь посчитать?
5
Мы посчитали 1 овцу
Мы посчитали 2 овцы
Мы посчитали 3 овцы
Мы посчитали 4 овцы
Мы посчитали 5 овец
[root@localhost .in]#
```

`@builder`
```console
[builder@localhost ~]$ tree -A
.
├── RPM
│   ├── BUILD
│   ├── RPMS
│   │   └── noarch
│   ├── SOURCES
│   │   └── sheepcounter-pkg-1.0.tar.gz
│   ├── SPECS
│   │   └── sheepcounter-pkg.spec
│   └── SRPMS
├── debug
├── in
│   ├── SOURCE_DATE_EPOCH
│   ├── nosrpm
│   │   └── sheepcounter-pkg-1.0-alt1.nosrc.rpm
│   └── srpm
│       └── sheepcounter-pkg-1.0-alt1.src.rpm
└── tmp

13 directories, 5 files
[builder@localhost ~]$ rpmbuild -ba -enable=numbers RPM/SPECS/sheepcounter.spec
<...>
+ ./configure --build=x86_64-alt-linux --host=x86_64-alt-linux --prefix=/usr --exec-prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --datadir=/usr/share --includedir=/usr/include --libdir=/usr/lib64 --libexecdir=/usr/lib --localstatedir=/var/lib --sharedstatedir=/var/lib --mandir=/usr/share/man --infodir=/usr/share/info --disable-dependency-tracking --disable-silent-rules --runstatedir=/var/run --without-included-gettext --enable-numbers
<...>
Wrote: /usr/src/RPM/SRPMS/sheepcounter-1.0-alt1.src.rpm (w2.lzdio)
Wrote: /usr/src/RPM/RPMS/x86_64/sheepcounter-1.0-alt1.x86_64.rpm (w2.lzdio)
Wrote: /usr/src/RPM/RPMS/x86_64/sheepcounter-debuginfo-1.0-alt1.x86_64.rpm (w2.lzdio)
[builder@localhost ~]$
```

`@rooter`
```console
[root@localhost .in]# rpm -i --replacefiles /usr/src/RPM/RPMS/x86_64/sheepcounter-1.0-alt1.x86_64.rpm
<13>Jul 30 10:10:19 rpm: sheepcounter-1.0-alt1 1753870086 installed
                                                                  [root@localhost .in]#
[root@localhost .in]# sheepcounter
Let's count sheeps together!

How many sheeps do you want to count?
10
We counted 1 sheep
We counted 2 sheeps
We counted 3 sheeps
We counted 4 sheeps
We counted 5 sheeps
We counted 6 sheeps
We counted 7 sheeps
We counted 8 sheeps
We counted 9 sheeps
We counted 10 sheeps
[root@localhost .in]# LC_MESSAGES=ru_RU.UTF-8 sheepcounter
Давай считать овец вместе!

Сколько овец ты хочешь посчитать?
21
Мы посчитали 1 овцу
Мы посчитали 2 овцы
Мы посчитали 3 овцы
Мы посчитали 4 овцы
Мы посчитали 5 овец
Мы посчитали 6 овец
Мы посчитали 7 овец
Мы посчитали 8 овец
Мы посчитали 9 овец
Мы посчитали 10 овец
Мы посчитали 11 овец
Мы посчитали 12 овец
Мы посчитали 13 овец
Мы посчитали 14 овец
Мы посчитали 15 овец
Мы посчитали 16 овец
Мы посчитали 17 овец
Мы посчитали 18 овец
Мы посчитали 19 овец
Мы посчитали 20 овец
Мы посчитали 21 овцу
[root@localhost .in]#
```